<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Election Visulisation</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <!--modules css-->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/donut.css">
    <link rel="stylesheet" href="css/custom.css">
</head>

<body>
    <!-- Wrap all page content here -->
    <div id="wrap">
        <!-- container start -->
        <div class="container">
            <!-- row 1 start -->
            <div class="row">
                <nav class="navbar navbar-inverse" role="navigation">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#">Swedish Election</a>
                    </div>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" id="searchfield" placeholder="Municipality">
                        </div>
                        <button type="button" id="searchMun" class="btn btn-primary">Search</button>
                        <button type="button" id="mining" class="btn btn-warning">Mining for similarity</button>
                    </form>
                </nav>
                <!-- row 1 end -->
            </div>
            <br>
            <!-- row 2 start -->
            <div class="row">
                <div class="col-xs-5 col-md-3" align="center">
                    <input type="text" id="currYear" value="2014" align="center" />
                    <div id="year"></div>
                    <br>
                    <br>
                </div>
                <!-- row 3 end -->
            </div>
            <!-- row 3 start -->
            <div class="row vertical-align">
                <div class="col-xs-5 col-md-3" align="center">
                    <div class="btn-group-vertical" role="group" align="center" style="height:80vh;" id="party">
                        <button type="button" class="btn btn-default blue active" value="All">Alla</button>
                        <button type="button" class="btn btn-mod" value="Moderaterna">Moderaterna</button>
                        <button type="button" class="btn btn-cent" value="Centerpartiet">Centerpartiet</button>
                        <button type="button" class="btn btn-folk" value="Folkpartiet">Folkpartiet</button>
                        <button type="button" class="btn btn-krist" value="Kristdemokraterna">Kristdemokraterna</button>
                        <button type="button" class="btn btn-mil" value="Miljöpartiet">Miljöpartiet</button>
                        <button type="button" class="btn btn-block form-control btn-soc" value="Socialdemokraterna">Socialdemokraterna</button>
                        <button type="button" class="btn btn-van" value="Vänsterpartiet">Vänsterpartiet</button>
                        <button type="button" class="btn btn-block btn-sve" value="Sverigedemokraterna">Sverigedemokraterna</button>
                        <button type="button" class="btn btn-ovr" value="övriga partier">Övriga partier</button>
                    </div>
                </div>
                <div class="col-xs-7 col-md-3" align="center">
                    <div id="map" style="height: 80vh;width:50vh"></div>
                </div>
                <div class="col-xs-12 col-md-6" align="right">
                    <div id="donut" style="height:80vh;"></div>
                </div>
                <!-- row 3 end -->
            </div>
            <!-- container end -->
        </div>
        <!-- Wrap end -->
    </div>
    <!-- Footer start -->
    <div id="footer">
        <div class="container">
            <nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
                <p class="muted credit">Example courtesy <a href="http://martinbean.co.uk">Martin Bean</a> and <a href="http://ryanfait.com/sticky-footer/">Ryan Fait</a>.</p>
            </nav>
        </div>
        <!-- Footer end -->
    </div>
    <script>
    window.jQuery || document.write('<script src="js/vendor/jquery-2.2.1.min.js"><\/script>')
    </script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <!--script src="js/vendor/bootstrap-slider.min.js"></script-->
    <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    <script src="js/vendor/d3.min.js"></script>
    <script src="js/vendor/topojson.v1.min.js"></script>
    <script src="js/vendor/underscore-min.js"></script>
    <script src="js/vendor/d3.tip.v0.6.3.js"></script>
    <!--modules js-->
    <script src="js/main.js"></script>
    <script src="js/map.js"></script>
    <script src="js/donut.js"></script>
    <script type='text/javascript'>
    $(function() {

        $("#searchfield").autocomplete({
            /*Source refers to the list of fruits that are available in the auto complete list. */
            source: function(request, response) {
                var results = $.ui.autocomplete.filter(REGIONARRAY, request.term);

                response(results.slice(0, 5));
            },
            // Must have to get it runnung with slider
            open: function(event, ui) {
                $(".ui-slider-handle").css("z-index", -1);
            },
            close: function(event, ui) {
                $(".ui-slider-handle").css("z-index", 2);
            }
        });

        $("#year").slider({
            animate: "slow",
            min: 0,
            max: ELECTIONYEARSARRAY.length - 1,
            value: 2014,
        });

    });


    $("#searchMun").click(function() {

        var trueVal = $("#year").slider("value");
        var sliderYear = ELECTIONYEARSARRAY[trueVal];

        var closestYear = closest(ELECTIONYEARSARRAY, sliderYear);

        //Get
        var str = $('#searchfield').val();

        //Set
        $('#searchfield').val('');

        str1 = (str.substr(0, 1)).toUpperCase();

        str2 = (str.substr(1)).toLowerCase();

        str = str1 + str2;

        if (!str.indexOf(" ").length) {
            var i = str.indexOf(" ");
            str = str.replace(str[i + 1], str[i + 1].toUpperCase());
        }
        if (!str.indexOf("-").length) {
            var i = str.indexOf("-");
            str = str.replace(str[i + 1], str[i + 1].toUpperCase());
        };

        var formatString = str;

        var validReg = validateRegion(formatString);

        if (validReg) {
            donut1.drawMun(formatString, closestYear);
            map1.munBorder(formatString);
            $("#searchfield").attr("placeholder", formatString).val("").focus().blur();
        } else {
            $("#searchfield").attr("placeholder", "Not a region").val("").focus().blur();

        }

    });

    $("#mining").click(function() {

        var trueVal = $("#year").slider("value");
        var sliderYear = ELECTIONYEARSARRAY[trueVal];

        var closestYear = closest(ELECTIONYEARSARRAY, sliderYear);

        //Get
        var str = $('#searchfield').val();

        //Set
        $('#searchfield').val('');

        str1 = (str.substr(0, 1)).toUpperCase();

        str2 = (str.substr(1)).toLowerCase();

        str = str1 + str2;

        if (!str.indexOf(" ").length) {
            var i = str.indexOf(" ");
            str = str.replace(str[i + 1], str[i + 1].toUpperCase());
        }
        if (!str.indexOf("-").length) {
            var i = str.indexOf("-");
            str = str.replace(str[i + 1], str[i + 1].toUpperCase());
        };

        var formatString = str;

        var validReg = validateRegion(formatString);

        if (validReg) {
            map1.regionsimilarities(closestYear, formatString);
            $("#searchfield").attr("placeholder", formatString).val("").focus().blur();
        } else {
            $("#searchfield").attr("placeholder", "Not a region").val("").focus().blur();

        }
    });


    $('#year').on('slidestop', function(event, ui) {

        $("#currYear").val(ELECTIONYEARSARRAY[ui.value]);

        var trueVal = $("#year").slider("value");
        var sliderYear = ELECTIONYEARSARRAY[trueVal];

        var closestYear = closest(ELECTIONYEARSARRAY, sliderYear);

        if (closestYear < 1998) {
            $('.btn-sve').prop('disabled', true);
        } else {
            $('.btn-sve').prop('disabled', false);
        }

        if (closestYear < 1982) {
            $('.btn-mil').prop('disabled', true);
        } else {
            $('.btn-mil').prop('disabled', false);
        }

        if (closestYear == 1988) {
            $('.btn-krist').prop('disabled', true);
        } else {
            $('.btn-krist').prop('disabled', false);
        }

        var party = $('#party button.active').val();

        if (party == "All") {
            map1.colorByYear(closestYear);
        } else {
            map1.colorByParty(closestYear, party);
        }

    });

    $("#party > .btn").on("click", function() {

        $(this).addClass("active").siblings().removeClass("active");

        var trueVal = $("#year").slider("value");
        var sliderYear = ELECTIONYEARSARRAY[trueVal];

        //var sliderYear = $('#year').slider('getValue');
        var closestYear = closest(ELECTIONYEARSARRAY, sliderYear);

        var party = $('#party button.active').val();

        if (party == "All") {
            map1.colorByYear(closestYear);
        } else {
            map1.colorByParty(closestYear, party);
        }

    });
    </script>
</body>

</html>